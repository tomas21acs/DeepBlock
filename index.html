<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DeepRide - Deep Work Tracker</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-o9N1j7kG8GZ7P4gsTUMHbY2YyQp3I+YB53d2v8tpv6o="
      crossorigin=""
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div id="config-warning" class="config-warning hidden" role="alert">
      <strong>Action needed:</strong>
      <span id="config-warning-message"
        >Update <code>firebaseConfig</code> inside <code>script.js</code> with your
        Firebase project values to enable authentication.</span
      >
    </div>
    <div id="app">
      <main id="auth-screen" class="card">
        <h1>DeepRide</h1>
        <p class="subtitle">Conquer the Angliru one Deep Block at a time.</p>
        <div class="tab-toggle">
          <button id="show-login" class="active">Login</button>
          <button id="show-register">Register</button>
        </div>
        <form id="login-form" class="auth-form">
          <label>
            Email
            <input type="email" id="login-email" required />
          </label>
          <label>
            Password
            <input type="password" id="login-password" required />
          </label>
          <button type="submit" class="primary">Login</button>
          <p class="form-feedback" id="login-feedback"></p>
        </form>
        <form id="register-form" class="auth-form hidden">
          <label>
            Email
            <input type="email" id="register-email" required />
          </label>
          <label>
            Password
            <input type="password" id="register-password" required />
          </label>
          <button type="submit" class="primary">Create Account</button>
          <p class="form-feedback" id="register-feedback"></p>
        </form>
      </main>

      <div id="dashboard" class="hidden">
        <header>
          <div>
            <h2>DeepRide Dashboard</h2>
            <p id="welcome"></p>
          </div>
          <button id="logout" class="secondary">Log out</button>
        </header>

        <section class="progress card">
          <div class="progress-header">
            <div class="progress-copy">
              <h3>Alto de l'Angliru</h3>
              <p class="progress-subtitle">
                Every Deep Block propels you up the Asturian giant. Watch your
                rider conquer the map and the gradient.
              </p>
            </div>
            <p id="total-progress-text" class="progress-total">
              Loading progress...
            </p>
          </div>

          <div class="angliru-visuals">
            <div
              class="angliru-card angliru-map-card"
              role="img"
              aria-label="Interactive map of the Alto de l'Angliru climb"
            >
              <div id="angliru-map"></div>
              <div class="map-overlay" aria-hidden="true"></div>
            </div>
            <figure
              class="angliru-card angliru-profile-card"
              role="img"
              aria-label="Elevation profile of the Alto de l'Angliru climb"
            >
              <svg
                id="angliru-profile-svg"
                viewBox="0 0 600 320"
                preserveAspectRatio="xMidYMid meet"
              >
                <defs>
                  <linearGradient
                    id="angliru-profile-area-gradient"
                    x1="0"
                    y1="1"
                    x2="0"
                    y2="0"
                  >
                    <stop offset="0%" stop-color="rgba(8, 25, 46, 0.75)" />
                    <stop offset="100%" stop-color="rgba(37, 99, 235, 0.15)" />
                  </linearGradient>
                  <linearGradient
                    id="angliru-profile-line-gradient"
                    x1="0%"
                    y1="0%"
                    x2="100%"
                    y2="0%"
                  ></linearGradient>
                  <linearGradient
                    id="angliru-profile-progress-gradient"
                    x1="0%"
                    y1="0%"
                    x2="100%"
                    y2="0%"
                  ></linearGradient>
                  <filter
                    id="angliru-profile-glow-filter"
                    x="-50%"
                    y="-50%"
                    width="200%"
                    height="200%"
                  >
                    <feGaussianBlur stdDeviation="16" result="blur" />
                    <feMerge>
                      <feMergeNode in="blur" />
                      <feMergeNode in="SourceGraphic" />
                    </feMerge>
                  </filter>
                </defs>
                <rect width="600" height="320" class="profile-background" />
                <path
                  id="angliru-profile-shadow"
                  fill="url(#angliru-profile-area-gradient)"
                  opacity="0.7"
                ></path>
                <path
                  id="angliru-profile-glow"
                  fill="none"
                  stroke="rgba(56, 189, 248, 0.4)"
                  stroke-width="18"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  opacity="0.3"
                  filter="url(#angliru-profile-glow-filter)"
                ></path>
                <path
                  id="angliru-profile-path"
                  fill="none"
                  stroke="url(#angliru-profile-line-gradient)"
                  stroke-width="8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  opacity="0.25"
                ></path>
                <path
                  id="angliru-profile-progress"
                  fill="none"
                  stroke="url(#angliru-profile-progress-gradient)"
                  stroke-width="8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
                <g id="angliru-profile-cyclist" class="cyclist-icon" transform="translate(0 0)">
                  <circle class="wheel" cx="-9" cy="0" r="6"></circle>
                  <circle class="wheel" cx="9" cy="0" r="6"></circle>
                  <path class="frame" d="M-9 0 L-2 -9 L11 1 L-4 1 Z"></path>
                  <path class="body" d="M-2 -9 Q2 -20 11 -16 L6 -5"></path>
                  <circle class="head" cx="11" cy="-22" r="4"></circle>
                </g>
              </svg>
            </figure>
          </div>
          <button id="start-deep-block" class="primary">Start New Deep Block</button>
        </section>

        <section class="card" id="active-deep-block" aria-live="polite">
          <h3>New Deep Block</h3>
          <form id="deep-block-form" class="deep-block-form hidden">
            <label>
              Duration (minutes)
              <input type="number" id="duration" min="1" max="300" required />
            </label>
            <label>
              Goal
              <input type="text" id="goal" maxlength="100" required />
            </label>
            <button type="submit" class="primary">Start</button>
            <p class="form-feedback" id="deep-block-feedback"></p>
          </form>
          <div id="countdown" class="hidden">
            <div class="timer-circle">
              <svg viewBox="0 0 120 120">
                <circle cx="60" cy="60" r="54" class="timer-bg"></circle>
                <circle cx="60" cy="60" r="54" class="timer-progress" id="timer-progress"></circle>
              </svg>
              <div class="timer-text">
                <span id="timer-display">00:00</span>
              </div>
            </div>
            <button id="cancel-timer" class="secondary">Cancel</button>
          </div>
          <div id="post-block" class="hidden">
            <h4>Great job!</h4>
            <form id="post-block-form">
              <label>
                Focus rating (1-10)
                <input type="number" id="focus-rating" min="1" max="10" required />
              </label>
              <label>
                Completion rating (1-10)
                <input type="number" id="completion-rating" min="1" max="10" required />
              </label>
              <button type="submit" class="primary">Save Deep Block</button>
              <p class="form-feedback" id="post-block-feedback"></p>
            </form>
          </div>
        </section>

        <section class="card" id="history">
          <div class="history-header">
            <h3>Deep Block History</h3>
            <button id="refresh-history" class="secondary">Refresh</button>
          </div>
          <ul id="history-list" class="history-list"></ul>
        </section>
      </div>
    </div>

    <div id="confetti-container" aria-hidden="true"></div>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-o5Mqt7LfM651c01rbPvvrH+3VYcgHgl41YMBXhJtkhA="
      crossorigin=""
    ></script>
    <script type="module" src="script.js"></script>
  </body>
</html>
